---
layout: doc
title: Migration From Amazon Cognito
description: How to migrate your users to FusionAuth from Amazon Cognito.
redirect_from:
 - /cognito/
 - /cognito
---
:page-liquid:

:migration_source_name: Cognito
:migration_source_dir: cognito
:script_supports_social_logins: false
:add-tenant-image-role: bottom-cropped

== Overview

This document will help you migrate off of Amazon Cognito. If you are looking to compare FusionAuth and Cognito, link:/blog/2018/09/18/amazon-cognito-and-fusionauth-comparison/[this document may help].

This guide assumes you have installed FusionAuth. If you have not, please link:/docs/v1/tech/installation-guide/[view our installation guides] and install FusionAuth before you begin. For more general migration information, please view the link:../general/[FusionAuth migration guide].

TODO add TOC
TODO add pictures

There are a number of different ways applications can be integrated with Cognito, and it would be difficult to cover them all. 

Additionally, Cognito https://forums.aws.amazon.com/thread.jspa?threadID=296932&tstart=0[does not allow for password hash export]. You will need to perform a slow migration if you don't want to force your users to reset their passwords. If you need to leave Cognito quickly, you can do a bulk migration and then force everyone to reset their passwords. This option will be covered, but the primary focus of this guide will be on setting up a migration that does not require users to change their password.

== Planning Considerations

=== Slow Migration or Bulk Migration

If you want to preserve your user's passwords, the only option is a slow migration. Doing so allows users to log in to FusionAuth with their Cognito passwords. This is the recommended approach and will be fully illustrated in this guide.

Slow migrations use Connectors, which are a paid feature. 

Learn more about link:/docs/v1/tech/migration-guide/general/#types-of-migrations[types of migrations].

If on the other hand, you are okay with resetting user passwords, a <<Bulk Migration>> might work for you. Review that section for more details on the required steps. You may also perform a bulk migration after a slow migration has run for a few months. At that time, active users will have been transparently migrated and the other users may be okay with resetting their passwords.

=== Mapping User Attributes

include::docs/v1/tech/migration-guide/_mapping-user-attributes.adoc[]

=== One Tenant or Many

In Cognito, users are placed in https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools.html[User Pools]. FusionAuth calls these link:/docs/v1/tech/core-concepts/tenants/[Tenants]. Both of these configurations include information about users, applications and other configuration.

Each tenant in FusionAuth is a distinct user space. You may choose to merge multiple Cognito User Pools into one FusionAuth tenant or keep them separate. Learn more about link:/docs/v1/tech/guides/multi-tenant/[FusionAuth tenants].

=== Identity Pools

In Cognito, external identity providers are managed using https://docs.aws.amazon.com/cognito/latest/developerguide/external-identity-providers.html[Identity Pools]. With FusionAuth, these are called link:/docs/v1/tech/identity-providers/[Identity Providers]. Review the supported FusionAuth link:/docs/v1/tech/identity-providers/[Identity Providers] to ensure your social providers are supported. At this time, all Cognito external identity providers are supported, except "Login with Amazon". If not supported explicitly, a provider may work with an OIDC or SAML connection. Otherwise, please open a https://github.com/fusionauth/fusionauth-issues/[feature request].

include::docs/v1/tech/migration-guide/_social-login-migration.adoc[]

=== Other Entities

:other_migrated_entities: app clients or password policies
include::docs/v1/tech/migration-guide/_other-entities-intro.adoc[]
:other_migrated_entities!:

* https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools-working-with-aws-lambda-triggers.html[Lambda Triggers] are ways for you to customize authentication or authorization workflows with AWS Lambdas. FusionAuth has a similar concept called link:/docs/v1/tech/lambdas/[Lambdas], which are written in JavaScript. FusionAuth also has link:/docs/v1/tech/events-webhooks/[numerous webhooks] fired at certain points in the user lifecycle.
* Cognito is deeply integrated with https://aws.amazon.com/iam/[AWS IAM], in particular for roles and permissions. FusionAuth has independent link:/docs/v1/tech/core-concepts/roles[roles] that are configured on an application by application basis and made available in the token after successful authentication.
* Cognito has the concept of a https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-integration.html[Hosted UI] where users can login and/or register. FusionAuth has link:/docs/v1/tech/core-concepts/integration-points/#hosted-login-pages[hosted login pages] which fulfill a superset of the functionality of Cognito's Hosted UI and are link:/docs/v1/tech/themes/[customized via themes].
* In Cognito, users log into https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-idp-settings.html[app clients] if you are using the Hosted UI. In FusionAuth, Applications are a corresponding concept, but users are associated with them through link:/docs/v1/tech/core-concepts/appliations/[Applications]. You can migrate both your client Id and client secret.
* Cognito can send emails on your behalf, such as forgot password notifications. FusionAuth can do so as well; link:/docs/v1/tech/email-templates/[the templates are customizable].
* Cognito offers the client credentials grant. FusionAuth offers a constrained version of this using link:/docs/v1/tech/core-concepts/entity-management/[Entity Management].
* Refresh tokens allow JWTs to be refreshed without a user logging in. These can be migrated from Cognito using the link:/docs/v1/tech/apis/users/#import-refresh-tokens[Import Refresh Tokens API].
* Cognito allows for custom attributes, but they must be configured at User Pool creation. In FusionAuth, custom user attributes are stored on the `user.data` field and are dynamic, searchable and unlimited in size. Any valid JSON value may be stored in this field.
* Cognito supports MFA. FusionAuth also link:/docs/v1/tech/guides/multi-factor-authentication/[supports MFA], which may be enabled for a tenant and configured for a user at any time.

[NOTE]
====
In FusionAuth, users are explicitly mapped to applications with a link:/docs/v1/tech/core-concepts/registrations/[Registration]. 

Cognito, in contrast, gives users access to all Cognito applications in a user pool by default. 
====

==== Identifiers 

include::docs/v1/tech/migration-guide/_identifiers.adoc[]

=== Differences

There are some fundamental differences between FusionAuth and Cognito. If your application relies on certain Cognito specific functionality, please review this section carefully.

* Cognito has https://docs.aws.amazon.com/cognito/latest/developerguide/limits.html[quotas] that apply to logins and operations. FusionAuth has no quotas. Instead, you are limited by the resources such as memory, CPU and database capacity provided to a FusionAuth instance.
* Cognito has https://docs.aws.amazon.com/cognito/latest/developerguide/getting-credentials.html[the ability to get AWS credentials] when a user logs in. FusionAuth has no inherent ability to do so. If this is required, you could use FusionAuth as a https://docs.aws.amazon.com/cognito/latest/developerguide/open-id.html[Cognito OIDC External Identity Provider] and have Cognito provision the AWS credentials.
* FusionAuth does not support custom scopes. There is an https://github.com/FusionAuth/fusionauth-issues/issues/275[open feature tracking issue].
* FusionAuth has no analog to https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-sync.html[Cognito Sync]. If you need this feature, use a specialized syncing library.

Once you've planned the migration of other entities, the next step is to set up FusionAuth to connect to Cognito to import users during login.

== Importing Users

Next up, import the user data. Because this is a slow migration, this will take place over time. But you can set up a test environment to confirm it will work before deploying to production. Here are the steps we need to take.

1. Set Up FusionAuth
2. Set Up AWS Components
3. Set Up the Connector
4. Log In as a Test User
5. Verify the Import
6. The Final Destination of Imported Users

=== Set Up FusionAuth

include::docs/v1/tech/migration-guide/_set-up-fusionauth.adoc[]

==== Create a Test Tenant

include::docs/v1/tech/migration-guide/_create-test-tenant.adoc[]

==== Create a Test Application

include::docs/v1/tech/migration-guide/_create-test-application.adoc[]

=== Set Up AWS Components

There are two main components you need to set up. The first is an App Client. The second is an API Gateway/Lambda configuration which will accept login requests from FusionAuth and proxy them to Cognito.

You must set up both of these components for each Cognito User Pool whose users you wish to migrate.

==== Configuring App Clients

FusionAuth will send login requests to Cognito. You need to configure a special App Client to receive these requests. This guide will walk through configuration using the AWS Console, but you can also configure this using CloudFormation, Terraform or any other IAC tool.

[NOTE]
====
These instructions are for the new Cognito interface released in fall of 2021. 
====

Visit the Cognito user pool configuration containing the users you want to migrate. Navigate to the [breadcrumb]#Create app client# screen. 

Select `Other` for the [field]#App type#. Give it a name, such as `FusionAuth migration`. Ensure [field]#Client secret# field is set to not create a secret. 

For the [breadcrumb]#Authentication flows# field, check `ALLOW_USER_PASSWORD_AUTH` to enable username password based authentication. This is the form of authentication FusionAuth will use to migrate over your users. 

You must enter a value in the [field]#Allowed callback URLs#, but this won't be used. You can use a value like `https://example.com`.

Make sure the client can read attributes you want to migrate over, but include the username or email address at a minimum.

Everything else can be left with the default values. At the end, you'll end up with an app client configuration similar to this:

image::migration-guide/{migration_source_dir}/cognito-app-client-configuration.png[Configuring an app client for migration.,width=1200]

Save the new configuration. Record the client Id. This will be a value like `5pmi4ct0o4n6ulqj7vlnkm6nhh`.

image::migration-guide/{migration_source_dir}/cognito-app-client-list.png[Finding the app client id.,width=1200]

Next, you'll need to set up an API Gateway and Lambda to receive the login requests from FusionAuth, submit the credentials to this app client and return a FusionAuth friendly JSON object.

==== Configuring the API Gateway/Lambda

The purpose of this component is to receive the login request from FusionAuth, attempt to log the person in via Cognito, and then return a FusionAuth user object on success.

When you are doing this, you'll need to modify the lambda code that runs. The lambda will call the https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_GetUser.html[GetUser] API after successful authentication to get additional user attributes. Here's the entire AWS lambda:

[source,javascript]
.AWS Connector Lambda code
----
include::https://raw.githubusercontent.com/FusionAuth/fusionauth-example-cdk-cognito-migration/main/resources/index.js[]
----

Make sure to modify the constants at the top of the file.

[source,javascript]
.AWS Connector Lambda constants to modify
----
const clientId = // the value of the App Client Id you created above
const region = // the AWS region where your user pool exists
const fusionAuthApplicationId = // the Id of the FusionAuth application to which you want to register the users automatically. Must exist in the tenant.
const authorizationHeaderValue = // a random string to ensure that only the Connector can execute this lambda
----

You should also modify the `processUserJSON` function. This converts the JSON returned from Cognito into JSON FusionAuth expects. You can see samples of both below. The exact logic of this function will depend on your UserPool custom attributes and business logic. You could, for example, give users certain FusionAuth roles, register them for more than one application or add them to a previously created FusionAuth group.

[source,json]
.Sample User Data Response from Cognito
----
{
  "Username": "06744664-df6e-48cc-9421-3d56a9732172",
  "Attributes": [
    {
      "Name": "sub",
      "Value": "06744664-df6e-48cc-9421-3d56a9732172"
    },
    {
      "Name": "website",
      "Value": "http://example.com"
    },
    {
      "Name": "given_name",
      "Value": "Test"
    },
    {
      "Name": "middle_name",
      "Value": "T"
    },
    {
      "Name": "family_name",
      "Value": "Testerson"
    },
    {
      "Name": "email",
      "Value": "test@example.com"
    }
  ]
}
----

The `processUserJSON` will transform the above into a FusionAuth compatible format, as displayed below:

[source,json]
.Sample Successful Login JSON
----
include::docs/src/json/users/login-migrated-response.json[]
----

Once you have the custom lambda logic updated, it is time to deploy the AWS API.

==== Deploying the AWS API

You have a number of options here. It's probably simplest to deploy this with CloudFormation, but pick the option that works for you.

===== CloudFormation

This template sets up an API gateway and accepts a POST to the root resource. The lambda function is subject to the https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-lambda-function-code.html[limits outlined in the AWS documentation] for the `ZipFile` property.

Below is the full template. Note the one looooong line containing the lambda code. You'll modify that next.

[source,yaml]
.CloudFormation API Gateway
----
include::https://raw.githubusercontent.com/FusionAuth/fusionauth-example-cdk-cognito-migration/main/cloudformation/cloudformation.yaml[]
----

You must modify the lambda code to reflect changes made above. Find a JavaScript minifier online and run the customized lambda code through it. Then replace the line after `ZipFile: |` with your code.

[source,yaml]
.CloudFormation API Lambda Code Customization
----
  lambdaFunction:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          # REPLACE THIS LINE
----

Then, create this stack as you would any other CloudFormation stack.

===== AWS CDK

If you'd like to do this with the AWS CDK, you can use https://github.com/FusionAuth/fusionauth-example-cdk-cognito-migration[this example project].

Here's an https://docs.aws.amazon.com/cdk/latest/guide/getting_started.html[introduction to the CDK].

// TODO you can apparently call lambdas directly via a URL now? https://twitter.com/0xdabbad00/status/1461785704212709379

===== Deploy In Your Environment With Your Tools

If you already have an API gateway setup or want to build from scratch, use the lambda (tested with the node14 runtime). It doesn't need any special permissions other than Cloudwatch logs. When you deploy this, ensure that the lambda code is called for `POST`s only. 

Here's the https://docs.aws.amazon.com/apigateway/latest/developerguide/getting-started.html[AWS documentation about setting up an API gateway with a lambda].

==== Testing The Deployed API

Now that you've deployed the API, you should have a URL that looks something like `\https://j2xbdwi6hf.execute-api.us-east-2.amazonaws.com/prod/`.

Now, test the login with the lambda. Use a user whose username and password you know and curl.

[source,shell]
.Testing the API Gateway and Lambda Configuration with Curl
----
curl -XPOST -H 'Authorization: <the value of authorizationHeaderValue>' \
https://j2xbdwi6hf.execute-api.us-east-2.amazonaws.com/prod/  -H 'Content-type: application/json' -d '{
  "loginId": "test@example.com",
  "password": "password"
}' 
----

If the user is authenticated correctly, you should receive a response like:

[source,json]
.Results of Testing the API Gateway and Lambda Configuration with Curl
----
{
  "user": {
    "data": {
      "migratedDate": "2021-11-19T21:50:19.048Z",
      "migratedFrom": "cognito",
      "website": "http://example.com"
    },
    "username": "06744664-df6e-48cc-9421-3d56a9732172",
    "email": "test@example.com",
    "id": "06744664-df6e-48cc-9421-3d56a9732172",
    "firstName": "Test",
    "lastName": "Testerson",
    "active": true,
    "tenantId": "30663132-6464-6665-3032-326466613934",
    "registrations": [{
      "applicationId": "85a03867-dccf-4882-adde-1a79aeec50df"
    }]
  }
}
----

If the authorization or credentials are incorrect, an empty body and a HTTP status code will be returned. You can see those by running `curl` with the `-vv` switch.

=== Set Up the Connector

Now you need to set up a Connector to use the AWS API you created. Log back in to the FusionAuth adminstrative user interface.

include::docs/v1/tech/shared/_premium-edition-blurb.adoc[]

Connectors are a feature limited to paid editions. Ensure you have a valid reactor license. Learn more about link:/docs/v1/tech/reactor/[activating reactor].

You should set up a different Connector for each Cognito User pool. 

After you have a license you need to do two things:

* Configure the Connector with the API URL and authorization header
* Configure the Tenant to use the Connector

==== Configure a Connector

First, create and configure the Connector. Navigate to [breadcrumb]#Settings -> Connectors# and add a new Generic Connector.

image::migration-guide/{migration_source_dir}/add-generic-connector.png[Adding a Generic Connector.,width=1200,role=bottom-cropped]

Configure the Connector:

* Add a name like `Cognito migration`.
* Set the [field]#Authentication URL# to the value of the API gateway endpoint you created above.
* Navigate to the [breadcrumb]#Headers# tab and add the custom header you configured your API to require.

At the end, you should have a screen like this:

image::migration-guide/{migration_source_dir}/configured-generic-connector.png[Configuring a Generic Connector.,width=1200,role=bottom-cropped]

Save the Connector.

Next, you need to configure your test tenant to use this Connector.

==== Configuring the Tenant

Navigate to your tenant settings: [breadcrumb]#Tenants -> Cognito import Tenant -> Connectors#. Click the [field]#Add policy# button. 

image::migration-guide/{migration_source_dir}/connector-policies.png[Connector policies for this Tenant.,width=1200,role=bottom-cropped]

The [field]#Connector# value should be the name of the Connector you created previously. You can restrict the email domains for which this Connector is used, but that isn't needed right now. Make sure that [field]#Migrate user# is enabled. It should look similar to:

image::migration-guide/{migration_source_dir}/add-connector-policy.png[Add Connector policy.,width=1200]

Save this configuration. Ensure that this Connector policy is at the top of the list by using the arrows in the administrative user interface. If so, all users will be checked against this Connector the first time they are seen. They'll then be migrated to the FusionAuth user database.

image::migration-guide/{migration_source_dir}/connector-policy-list-after-adding.png[Cognito Connector policy added and in list.,width=1200,role=bottom-cropped]

=== Log In as a Test User

In order to test that a migration occured correctly, you'll need to log in as a test user via the FusionAuth interface. When you set up the test application, you recorded the [field]#OAuth IdP login URL#.

image::migration-guide/{migration_source_dir}/find-login-url.png[Finding the login URL.,width=1200]

Copy and paste this URL and open it in a new incognito browser window. (If you don't use an incognito window, the admin user session will interfere with the test.) 

You should see the login screen.

image::migration-guide/{migration_source_dir}/user-login.png[The login page.,width=1200,role=bottom-cropped]

Enter the credentials that you would use to login with Cognito (the email address or username and the password). The user will be transparently migrated over to FusionAuth.

If the user was not migrated or the login was unsuccessful, check the [field]#Debug enabled# field in the Connector configuration by navigating to [breadcrumb]#Settings -> Connectors# and editing the Generic Connector. Navigate to [field]#System -> Event Log# and look for useful messages.

[NOTE]
====
After the test login, the user will be redirected to a URL like `\https://fusionauth.io/?code=FlZF97WIYLNxt4SGD_22qvpRh4fZ6kg_N89ZbBAy1E4&locale=fr&userState=Authenticated`. This happens because you haven't set up a web application to handle the authorization code redirect.

That is an important next step but is beyond the scope of this document. Consult the link:/docs/v1/tech/5-minute-setup-guide/[5 minute setup guide] for an example of how to do this.
====

Let's check that the import succeeded in another way by viewing the user in the administrative user interface.

=== Verify the Migration

include::docs/v1/tech/migration-guide/_verify-import.adoc[]

=== The Final Destination of Imported Users

After you are done testing, you can choose to migrate users into the default tenant or a new tenant. Whichever you choose, configure the Connector policy of the destination tenant.

If you aren't keeping users in the test tenant, delete it.

If you want to start over because you need to tweak a setting such as the default application registration, delete the tenant you created. This will remove all the users and other configuration for this tenant, giving you a fresh start. To do so, navigate to [breadcrumb]#Tenants# and choose the red trash can icon. 

image::migration-guide/{migration_source_dir}/list-of-tenants-delete-highlighted.png[Deleting a tenant.,width=1200,role=bottom-cropped]

Confirm your desire to delete the tenant. Depending on how many users exist, this may take some time. 

If easier, you can also delete any migrated users one at a time using the administrative user interface.

You have now set up a slow migration of users from Cognito. You can skip to <<What to Do Next>> or read more about a bulk migration.

== Bulk Migration

As mentioned above, a bulk migration of Cognito users requires all imported users to reset their passwords since password hashes are inaccessible. This is typically a poor choice as it negatively affects your users. However, if a slow migration won't work because of timing or for other reasons, you can move all user information other than passwords from Cognito to FusionAuth.

The benefits of a bulk migration:

* You can move your users all at once.
* You no longer have a dependency on Cognito.

The downsides of a bulk import:

* You must require all users to reset their password. You can do this in bulk via API calls. Or you can simply tell every user they need to reset their password on your login page before they can login.

To bulk migrate users, you need to do the following:

* Set up FusionAuth
* Extract all user data from Cognito
* Reformat the data into FusionAuth compatible JSON
* Import the users using the [Import User API](/docs/v1/tech/apis/users/#import-users)
* Reset all user passwords

Let's look at each of these steps in more detail.

=== Set Up FusionAuth For a Bulk Migration

You need to set up FusionAuth. This is similar to how you you would do it for the slow migration documented above.

:extra_permissions_text: pass:normal[Also, give the key permissions to `POST` to the API endpoint `/api/user/change-password`.]
include::docs/v1/tech/migration-guide/_create-api-key.adoc[]
:!extra_permissions_text:

include::docs/v1/tech/migration-guide/_create-test-tenant.adoc[]

=== Extract All Users

These instructions use the `aws` command line tool. If you don't have that installed, please install and configure it using https://aws.amazon.com/cli/[the AWS documentation].

Log in to the AWS console to find your user pool Id. It will look something like `us-east-2_ud90QwSeF`.

You can get a list of all your users via the `list-users` command:

[source,shell,title=Listing users in a pool]
----
aws cognito-idp list-users --user-pool-id us-east-2_ud90QwSeF
----

[source,json,title=list-users results]
----
{
    "Users": [
        {
            "Username": "05f1780a-17d4-4bba-befb-07c074a89d7b",
            "Attributes": [
                {
                    "Name": "sub",
                    "Value": "05f1780a-17d4-4bba-befb-07c074a89d7b"
                },
                {
                    "Name": "website",
                    "Value": "http://example.com"
                },
                {
                    "Name": "email_verified",
                    "Value": "true"
                },
                {
                    "Name": "given_name",
                    "Value": "testverified"
                },
                {
                    "Name": "middle_name",
                    "Value": "T"
                },
                {
                    "Name": "family_name",
                    "Value": "Testerson"
                },
                {
                    "Name": "email",
                    "Value": "testverified@example.com"
                }
            ],
            "UserCreateDate": "2021-11-16T17:27:47.442000-07:00",
            "UserLastModifiedDate": "2021-11-16T17:30:05.292000-07:00",
            "Enabled": true,
            "UserStatus": "CONFIRMED"
        },
        {
            "Username": "06744664-df6e-48cc-9421-3d56a9732172",
            "Attributes": [
                {
                    "Name": "sub",
                    "Value": "06744664-df6e-48cc-9421-3d56a9732172"
                },
                {
                    "Name": "website",
                    "Value": "http://example.com"
                },
                {
                    "Name": "given_name",
                    "Value": "Test"
                },
                {
                    "Name": "middle_name",
                    "Value": "T"
                },
                {
                    "Name": "family_name",
                    "Value": "Testerson"
                },
                {
                    "Name": "email",
                    "Value": "test@example.com"
                }
            ],
            "UserCreateDate": "2021-11-15T15:51:01.512000-07:00",
            "UserLastModifiedDate": "2021-11-15T15:53:06.566000-07:00",
            "Enabled": true,
            "UserStatus": "CONFIRMED"
        }
    ]
}
----

You may need to paginate your users. In this case, you'll receive a `NextToken` value in the JSON output.

[source,json,title=NextToken sample value]
----
{
  "Users": [
   ],
   "NextToken": "eyJQYWdpbmF0aW9uVG9rZW4iOiBudWxsLCAiYm90b190cnVuY2F0ZV9hbW91bnQiOiAxfQ=="
}
----

You'll then use that value in your next call:

[source,shell,title=Listing users in a pool using pagnination]
----
aws cognito-idp list-users --user-pool-id us-east-2_ud90QwSeF --starting-token eyJQYWdpbmF0aW9uVG9rZW4iOiBudWxsLCAiYm90b190cnVuY2F0ZV9hbW91bnQiOiAxfQ==
----

Collect all your user data together. You are now ready to transform your data. Use a tool like jq or any other programming language to transform the JSON.

In addition to all the other fields, make sure you:

* Create any registrations for users for existing applications.
* Configure the users to be part of the test tenant.
* Set a `user.data` field indicating these users are from a bulk import. For example, set `user.data.importSource` to `"cognito"`.
* Set the password to a random string, such as a UUID. You can set the encryption and salt methods to any value, because the password will be reset before the migration is complete.
* Optionally use the `sub` claim from Cognito as your user Id.

Here's an example of JSON suitable for import:

[source,json]
.Example Import Request JSON
----
include::docs/src/json/users/import-request.json[]
----

//TODO write ruby script to do this.

=== Import the Users

After you have transformed your data into the format expected by the Import Users API, load the users up. Place all the JSON files in a directory, and update the shell script below with the values of that directory, the FusionAuth instance hostname and the API key created above:

[source,sh]
.Example Import Shell Script
----
include::docs/v1/tech/migration-guide/_user-import-shell-script.sh[]
----

You can also look at the https://github.com/FusionAuth/fusionauth-import-scripts[Import scripts repository] for examples that process other provider's input data. Pull requests to add Cognito compatibility are welcome!

Now you need to reset the passwords of all these users. Ouch. Don't worry, you can script it.

=== Reset Passwords

Users may reset their password using the `Forgot Password` link on the login page, or you can use the API calls below to do it for them.

[WARNING.warning]
====
This script will send an email for every imported user. Ensure your SMTP server, configured in [breadcrumb]#Tenants -> Your Tenant -> Email#, is configured to handle the volume. 
====

Review the `Change Password` template to ensure the messaging is correct. Here is link:/docs/v1/tech/email-templates/templates-replacement-variables/#forgot-password[more information on modifying the templates].

You'll want to pull the `loginId` from the Cognito JSON export files. This will either be the username or the email address. For each user on this list, you'll want to call the link:/docs/v1/tech/apis/users/#start-forgot-password-workflow[forgot password API]. 

Use the API key created above in <<Set Up FusionAuth For a Bulk Migration>>.

This shell script will do that for you, assuming you have the `loginId`s in a single file. It sleeps periodically to avoid overloading the SMTP server.

[source,shell]
.Example User Password Reset
----
#!/bin/bash

API_KEY=...
LOGIN_ID_FILE=...
FA_HOST=...

for loginId in `cat $LOGIN_ID_FILE`; do
  sleep $[( $RANDOM % 10 > 8)] # sleeps 1 second ~10% of the time
  RES=`curl --max-time 600 \
       -s -w "%{http_code}" \
       -H "Authorization: $API_KEY" \
       -H "Content-type: application/json" \
       -XPOST \
       $FA_HOST/api/user/forgot-password \
       -d '{"loginId": "'$loginId'","sendForgotPasswordEmail": true}'`
  if [ "$RES" -ne "200" ]; then
    echo "Error: $RES";
    exit 1;
  fi
done
----

== What to Do Next

include::docs/v1/tech/migration-guide/_what-next.adoc[]

If you want to migrate client credentials grants, you'll need to create entities which correspond to each Cognito App Client. In addition, the scopes within FusionAuth are currently constrained to a certain format. link:/docs/v1/tech/core-concepts/entity-management/[Learn more about Entity Management].

You can migrate each of your Cognito app clients to a FusionAuth application using the link:/docs/v1/tech/apis/applications/#create-an-application[Application API], which allows you to set your Client Id and Client Secret. Doing this will minimize the impact on any applications which use the OAuth Authorization Code grant or Implicit grant.

=== Estimate the Slow Migration Timeline

When using a slow migration, you can estimate how many accounts will be migrated in a given period of time.

include::docs/v1/tech/migration-guide/_slow-migration-timeline.adoc[]

After this period of time, you may want to bulk migrate the rest of the users, or treat them as inactive and not migrate them.

Learn more about link:/docs/v1/tech/migration-guide/general/#slow-migration-implementation[general slow migration considerations].

== Additional Support

include::docs/v1/tech/migration-guide/_additional-support.adoc[]

:migration_source_name!:
:migration_source_dir!:
