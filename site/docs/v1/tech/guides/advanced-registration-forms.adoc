---
layout: doc
title: Advanced Registration Forms
description: Advanced Registration Forms
---
:page-liquid:

What Are Advanced Registration Forms
How Do I Use Advanced Registration Forms?
Differences Between Advanced and Basic Registration Forms
Setting Up
Creating A Form
  Create Form Fields
  Create a Form
    Steps
  Associate a Form With an Application
  The User Experience
  Theme the Form
Using the API to manage forms
  Why
  How
Form Field Details
  Storage
  Form Control
  Data Type
    Consents
    Confirmation
  Validation
Completing the Registration
Retrieving Data
Special Cases
  Registration When Using Other Identity Providers
  Multiple Forms Writing To The Same Underlying Data Storage

UX Recommendations
Limitations

== What Are Advanced Registration Forms

Advanced registration forms let you build powerful, multi-step, custom registration experiences with no coding required.

Pic TBD of building a reg form

You might be interested in this feature if you use the FusionAuth themed login pages for your application, and the default self service registration form isn't sufficient for your needs. Whether you want to break a form up into multiple steps for a better user experience, share registration forms between applications, or gather additional, app specific registration data, advanced registration forms can help.

The end goal of advanced registration forms is to take a typical user management task off your plate. XXX (too informal).

== How Do I Use Advanced Registration Forms?

*This is a paid edition feature and is unavailable in the community edition. Please visit link:/pricing[our pricing page] to learn more about paid editions.*

Here's a video showing setup and usage of the advanced registration forms feature.

video::NDXHE8I[youtube,width=560,height=315]

This guide will walk you through all the setup, but to use advanced registration forms, you must:
* create any custom form fields (optional). This includes 
* assemble pre-defined and custom form fields into steps, and those steps into a form
* configuring an application to use the form
* theming the form (optional, but highly recommended)

== Differences Between Advanced and Basic Registration Forms

FusionAuth has two types of registration forms, basic and advanced. Both of these allow a user to register themselves for your application.

Basic registration is one step, so all the fields are on one page. You can enable zero or more of the following user data fields:

* Birthdate
* First name
* Full name
* Last name
* Middle name
* Mobile phone

Any of these fields that are displayed can be required as well. You can choose to use a username or an email for your login identifier. A password will be displayed and will be required. 

Pic TBD basic registration

This is a very servicable implementation of a registration page; you can collect a variety of information and at the end the user will be associated with the application in FusionAuth and be able to log in. The look and feel can be modified using themes. You can also provide additional validation using client side JavaScript, managed through via the theme.

Advanced registration forms have the following additional features:

* You can collect additional data and have it stored in FusionAuth.
* You can add additional server side validation to any field, including matching a regular expression.
* There's support for more complicated field logic, such as consents and confirmation fields.
* You can create two or more steps to break up the registration process into less imposing chunks.

Basic registration forms are a subset of advanced registration forms, so anything you can do with the former you can also do with the latter.

== Setting Up

First, to use advanced registration forms, you must have a valid license key. Please visit link:/pricing[our pricing page] to review paid editions and buy a license.

Next, activate the license. You'll need to ensure that your FusionAuth instance has outbound network access. To activate, simply follow the steps outlined in the link:/docs/v1/tech/reactor[Reactor documentation].

== Creating A Form

Let's go ahead and create a custom form. For this example, you'll be creating a registration form for a todo application. While you won't write one, pretend that this application will not just capture todos, but allow you to assign a date to them and will remind you every day of what you need to do that day. One of the key differentiators of this fictitious application is that you can, in your profile, specify when you want to be notified of the day's tasks, and if you'd prefer to have a second reminder texted to you fifteen minutes after this time.

 In addition to the standard email/password form fields, you'll want to collect the following information on registration:

* Mobile phone number (for texting)
* Notification hour
* Second reminder desired?
* How did you find us?

To promote a better user experience, you'll split this into two steps; the first will be 

This is the scenario the next few sections will walk through.

=== Create Form Fields

The first step of building this form is to ensure that you have all the fields you need. The following fields are available by default:

* Password
* First name
* Full name
* Mobile phone
* Birthdate
* Last name
* Username
* Middle name
* Email

If you need additional fields, you'll want to create them. To do so, navigate to [breadcrumb]#Customizations -> Form Fields#. You'll see a list of the default fields, as well as a button to create new ones (the green plus sign). 

First, create the notification hour field. This is when the application will remind them of their upcoming tasks.

* Set [field]#Field# to `Custom registration data` and specify the key `registration.data.notificationhour`.
* Set [field]#Form control# to `Select`.
* Set [field]#Data type# to `Number`.
* Enable [field]#Required#.
* Paste the following into [field]#Options# (these are the select options):

[%hardbreaks]
4 
5
6 
7 
8
9
10

In this example, users will only be able to select a notification between the hours of 4 and 10 in the morning.

Save this and create a field about the second reminder:

* Set [field]#Field# to `Custom registration data` and specify the key `registration.data.secondreminder`.
* Set [field]#Form control# to ``.
* Set [field]#Data type# to `Number`.
* Enable [field]#Required#.
* Paste the following into [field]#Options# (these are the select options):

* Second reminder desired?
* How did you find us?

== Create a Form

== Associate a Form With an Application

Finally, make sure you enable self service registration on the applications on which you want to use the form. 

Pic TBD

== The User Experience

== Theme the Form

== Registration With Other Identity Providers: 

https://fusionauth.slack.com/archives/GNURTTC8N/p1598451509016000

== UX Recommendations

== Limitations



Then, navigate to [breadcrumb]#Tenants# and edit the tenant for which you wish to enable the feature. Go to the [breadcrumb]#Password# tab and the [breadcrumb]#Breached password detection settings# section. Click the checkbox to enable breached password detection. This will enable additional configuration options, as seen below:

image::guides/breached-password-detection/turn-on-detection.png[Turn on breached password detection,width=1200,role=box-shadow margin-right]

The default settings prevent use of compromised credentials in a number of contexts. Simply by enabling breached password detection, all users within this tenant will, from that moment forward, no longer be able to use any password that has been found to be breached by the FusionAuth team.

Passwords will be checked any time they are created or changed, such as when:

* A user is created
* A password change is initiated by an end user
* A administrator modifies a user's password 

Below, you can see an administrative user has received an error message because they attempted to update a password to a compromised value:

image::guides/breached-password-detection/admin-user-attempting-to-use-breached-password.png[Error message when an administrative user tries to use a compromised password.,width=1200,role=box-shadow margin-right]

If an administrative user changes any other user attribute without modifying the password, it won't be checked.

Any password creation or change, whether through user interaction with themed pages or an API call, will check the provided text against the latest corpus of compromised passwords. If there is a match, an error will be returned.

== Configuration Options

While the default settings are secure, you may want to configure this feature further. The [breadcrumb]#Breached password detection settings# section contains additional configuration options:

image::guides/breached-password-detection/breached-password-configuration-options.png[Breached password detection configuration options.,width=1200,role=box-shadow margin-right]

Each of these configuration options can be updated using either the administrative interface or by calling the link:../apis/tenants[Tenant API].

Let's examine each of these in turn.

=== Match Mode

When FusionAuth is checking for compromised credentials, there are a number of ways to attempt to match them. Assume you have a user with the username `richard@piedpiper.com` and they are trying to sign up with the password `This333ABCpassword!`.

The system could match on the password string (`This333ABCpassword!`) only. If the password was in the dataset and any other user had ever used it, FusionAuth would consider this a match and not allow this password.

Another way of matching would be to see if there are any sub-email accounts associated with that password. These are also called aliases by some email providers such as gmail. For instance, `richard+test@piedpiper.com` is an alias of `richard@piedpiper.com`. The system could check multiple addresses, such as `richard+test@piedpiper.com` and `richard+foo@piedpiper.com`. All of these addresses would be paired with the provided password and checked against the datasets. 

If you match on sub-email accounts, if the pair of `richard+test@piedpiper.com` and `This333ABCpassword!` was found in the corpus, FusionAuth would consider this a match and not allow this password. On the other hand, if `jared@piedpiper.com` and `This333ABCpassword!` were in the dataset, `richard@piedpiper.com` would still be allowed to use this password.

You could also narrow your scope further and match on only the username/password pair. If `richard@piedpiper.com` and `password!` appeared together in the password list, then FusionAuth would not allow this password. If `richard+test@piedpiper.com` and `This333ABCpassword!` or `jared@piedpiper.com` and `This333ABCpassword!` were, the password would be allowed.

You can control which level of matching will disallow use of a password. This is called the *Match mode* configuration setting and can be one of the following values:

* `High` means that should any of the above situations hold, the check fails. This is the strictest option.
* `Medium` means that an exact username and password match, a commonly compromised password is found, or a sub-email address match disqualifies the password.
* `Low` means that an exact username and password match or a commonly compromised password results in a failed check.

Assume the dataset contains `richard@piedpiper.com` with a password of `This333ABCpassword!`.com` with the same password. If the following users tried to register, the results for a given mode would be:

.What Is Allowed In Each Match Mode
[cols="35,35,10,10,10"]
|===
| Username | Password | High | Medium | Low

|`richard@piedpiper.com`
|`This333ABCpassword!`
|+++<i class="fas fa-times red-text"></i>+++
|+++<i class="fas fa-times red-text"></i>+++
|+++<i class="fas fa-times red-text"></i>+++

|`richard+test@piedpiper.com`
|`This333ABCpassword!`
|+++<i class="fas fa-times red-text"></i>+++
|+++<i class="fas fa-times red-text"></i>+++
|+++<i class="fas fa-check green-text"></i>+++

|`jian@piedpiper.com`
|`This333ABCpassword!`
|+++<i class="fas fa-times red-text"></i>+++
|+++<i class="fas fa-check green-text"></i>+++
|+++<i class="fas fa-check green-text"></i>+++

|`richard@piedpiper.com`
|`ADifferent333pass!`
|+++<i class="fas fa-check green-text"></i>+++
|+++<i class="fas fa-check green-text"></i>+++
|+++<i class="fas fa-check green-text"></i>+++

|===

The stricter the match mode, the more likely your users will be forced to choose a different password because the one they choose is not secure.

=== On Login

The matching and prohibition of compromised passwords takes place whenever the user is creating or changing a password, as mentioned above. However, there is one other time when a breached password check might make sense: at login. 

Consider this scenario: a user signs up on example.com with a password. They come to your site and sign up with the same password. They continue to use your application for months, but forget about their example.com account. 

Then, example.com has a data breach. They may send out a notice, but your user may ignore it or may forget to change their password on every system where they used it. 

If you only check for compromise when the password is created at registration or when modified, accounts will have credentials that have been compromised by breaches external to your system. The example.com breach negatively affects your application through the vector of the reused password. 

For this reason, it's a good idea to detect breached passwords whenever a user logs in.

However, this raises another issue. What do you do when you detect a breached password at login? At the other times FusionAuth is checking, the password is being modified, so it is easy to prohibit the compromised value; just notify the user that the password is not allowed.

However, at sign in, the user isn't expecting to change their password. So what is the appropriate action? The answer is that it depends. FusionAuth allows you flexibility to meet your requirements. In order of increasing impact on the user, the options are:

* Record the breach in metrics
* Send the user an email
* Require the user to change their password

With any of these choices, you can configure a webhook to publish the password breach event.

==== Recording the Breach 

Recording the breach and optionally firing a webhook is a good fit for two scenarios. If you're exploring breached password detection and are unsure how it will affect your end users, use this to gauge the number of compromised passwords. 

Another reason to use this option is if you want to rely solely on link:../events-webhooks/[webhooks] to take the appropriate action. You may handle a breached password in custom code, rather than using any of the default FusionAuth options. You could:

* Automatically run a security audit on systems to which the user with the compromised credentials has access
* Lock the account and send an SMS notification
* Force a password change and also flip a flag on their account to more closely monitor it for suspicious activity in the future

All of these require custom code on your end, of course.

==== Sending an Email

Sending the user an email lets the user know that their account could be compromised, but doesn't require any action.

This email is an link:../email-templates/[email template] which can be customized and localized like other email templates. You'll typically include a link to reset their password, but you may want to include other information as well. Below is the default HTML template.

.HTML Breached Password Email Template
[source,text]
----
include::docs/src/email/breached-password.html[]
----

Please see the link:/docs/v1/tech/email-templates/email-templates#breached-password[email template documentation] for more information, including available variables.

==== Requiring a Password Change

Another option for handling breached passwords at login is to require a password change. Once a password has been found to be breached, the account is marked as requiring a password change. The user is forced to change it whenever they attempt to login. Changing the 'On login' setting to a different option will have no effect on accounts already marked as needing a password change.

If you are using the FusionAuth themed login pages, after the user logs in with a compromised password they will see a page generated by the "OAuth Change password form" template. As with any other template, you can customize it. Please check out the link:../email-templates/[themes documentation] for more information.

If you are instead using the link:../apis/login[login API], the API call will respond with a `203` HTTP status code. Please review the API documentation for more information. 

You can also read the <<End User Experience>> section for more on what the end user will see.

=== Recommended Settings

The recommended options for maximum protection from compromised passwords:

* Set the *Match mode* to *High*.
* Configure the *On login* option to require a password change. Alternatively, set this value to record the result and configure a webhook to process password breach events.

Of course, choose options that work for you and your system. This is why FusionAuth provides all the configuration flexibility outlined above. 

== Breached Password Detection Reporting

Reporting is a key part of breached password detection. Aggregate information across all your users informs actions to take on detection, both within FusionAuth and in external systems. 

Reports let you know which users have breached account credentials. This allows you to contact the user or take other actions on the compromised account.

=== Overview Report

To view the the overview report, navigate to [breadcrumb]#Reactor#:

image::guides/breached-password-detection/overview-report.png[Overview password breach report,width=1200,role=box-shadow margin-right]

This report displays the total number of checked passwords, detected breaches and accounts with action required. These numbers are displayed for the entire FusionAuth instance as well as on a per tenant basis, should you be using multi-tenant functionality.

=== User Report

You can also view a list of all users with breached passwords. To do so, click on the *Breached users* search button on the [breadcrumb]#Reactor# page. You'll see this report:

image::guides/breached-password-detection/user-report.png[Individual password breach report,width=1200,role=box-shadow margin-right]

This is a paginated list of users with compromised credentials. You can then manage the user or lock their account. If you navigate to the user's details page, there is a warning about their vulnerable password:

image::guides/breached-password-detection/admin-user-vulnerable-message.png[The vulnerable password message in the admin interface,width=1200,role=box-shadow margin-right]

An administrator is also able to modify the user account. Options include locking their account, forcing a password change or resetting their password and sending them an email:

image::guides/breached-password-detection/acting-on-a-user.png[Acting on a user,width=1200,role=box-shadow margin-right]

=== Custom Reporting

If you have custom reporting needs, such as knowing the number of breached accounts over time, or finding how many users have had multiple password breaches, the best option is to ingest the data into your own analytics system.

You can do so by setting up a webhook to listen for the link:../events-webhooks/events#user-password-breach[`user.password.breach` event]. You can read more about setting up link:../events-webhooks/[webhooks here].

== End User Experience

What does the end user see when a breached password is detected? It depends on whether they are registering or logging in when the breach is detected.

It also is different if you are using the FusionAuth provided templates or have built your own integration using link:../apis/[APIs].

=== FusionAuth Provided Templates

If you use the FusionAuth templates, users who are registering will see this message, if they pick a compromised password:

image::guides/breached-password-detection/oauth-registration-breached-message.png[What a user who is registering with a breached password will see.,width=1200,role=box-shadow margin-right]

They will not be able to successfully complete a registration without choosing a more secure password.

If you enable breach detection on login, but do not require a password change, the end user will see no difference whether signing in with a secure or compromised password. If you configure FusionAuth to send an email, the user will receive that notice, of course.

If you, on the other hand, require a password change, when a user signs in with a breached password, they'll see this screen:

image::guides/breached-password-detection/oauth-login-breached-message.png[What a user who is signing in with a breached password will see.,width=1200,role=box-shadow margin-right]

These pages can be customized and localized, both in the messages displayed to the end user and in the look and feel. Please visit the link:../themes[themes documentation] for more information.

=== API Responses

When you create a user with the link:../apis/users[User APIs] and breached password detection is enabled, you'll receive an error if the password is compromised. The HTTP status code will be `400` and you'll receive a response containing an error object.

.JSON Response When A User Registers With A Breached Password
[source,json]
----
{
  "fieldErrors": {
    "user.password": [
      {
        "code": "[breachedCommonPassword]user.password",
        "message": "The [user.password] property value has been breached and may not be used, please select a different password."
      }
    ]
  }
}
----

If you enable breach detection on login and don't require a password change, you'll receive a `200` HTTP status code on successful login and the normal JSON response. Please see the link:../apis/login[Login API] documentation for more information.

Alternatively, if you require a password change, you'll receive a `203` HTTP status code. You'll also receive JSON explaining why the password change is required:

.JSON Response When A User Logs In With A Breached Password
[source,json]
----
{
  "changePasswordId": "yo0FiR_y7Rrtrk2vKe_F93PQ-nWljfGGWexgNSbHfXQ",
  "changePasswordReason": "Breached"
}
----

You can then use the link:../apis/users#change-a-users-password[Change a User's Password API] to, well, change the user's password.

== How It Works

Here's a high level diagram of the FusionAuth breached password detection service:

image::guides/breached-password-detection/breached-password-detection-diagram.png[Diagram of the breached password detection system.,width=1200,role=box-shadow margin-right]

New breached passwords are ingested and processed by FusionAuth on an ongoing basis. An additional encryption key is used to securely communicate with the FusionAuth Reactor service using a strong AES cipher. 

You can modify this key by navigating to [breadcrumb]#Reactor# and clicking the *Regenerate Key* button. When you do so, you'll be prompted to confirm this decision:

image::guides/breached-password-detection/regenerating-the-key.png[Regenerating the AES key.,width=1200,role=box-shadow margin-right]

Do this if you there was any chance the key was compromised, if directed to do so by FusionAuth support, or if you are troubleshooting your Reactor service connection.

== Limitations

Breached password detection in FusionAuth has a few limitations of which you should be aware.

As you might expect, it can't check passwords controlled by other systems, such as when you use an link:../identity-providers/[external identity provider].

All other password rules, as defined in the tenant configuration, also apply when passwords are changed. If you set a minimum length requirement of 25 characters, both conditions must be satisfied for a password to be accepted. Therefore, the user will have to select a password at least 25 characters long *and* not known to have been compromised.

Breached password detection is configured at the tenant level and applies to all applications within that tenant. For example, if you enable detection for the `Default` tenant, which contains the FusionAuth application, administrative users with access to that application will have their passwords checked.

The breached password detection webhook event, `user.password.breach`, is only fired when login breach detection is enabled. It is not fired at registration or password modification because in these cases the compromised password has never entered the FusionAuth system.

++++
{% capture relatedTag %}feature-breached-password-detection{% endcapture %}
{% include _doc_related_posts.liquid %}
++++





how many reg forms can you have 

create via app?

benefits

create form field

twitter for pets


what happens if you stop part way through

how can you theme this
messages


registration fields still show up even when advanced theme is chosen (if you edit, it goes away)


when theming, the message says "Custom Registration forms. These must match the domain names." not sure what that means

when adding new messages, you want to edit the properties file and save the theme

What do you need to do when you catch the user and end of flow?
- maybe look at jwts?


looks like the user is created on step 1
(what if no username or password)? -- you must have them on some step
if you have username and pw on second step, user isn't created until then

ican go down and up in form area, but can't cross steps


validation can go to regular expression
- should add link to regular expression parser
can't validate in reference to another field (min < max)


blog outline

set up a custom reg form for a real estate app
grab first name, email*, password*, mobile number (optional)
grab three custom fields after
pull the data from the user afterwards for a portal
(flask)


https://www.nngroup.com/articles/web-form-design/

What happens if you change the form field afterwards?
- no data transformtaion happens, you need to do that yourself

how can you see the second step? is there a preview?


Can you advanced register two times?

