---
layout: doc
title: Breached Password Detection
description: Learn how to create a passwordless experience for your end users.
---
:page-liquid:

== What Is Breached Password Detection

Breached password detection consists of the following tasks:

. Finding breached and compromised passwords.
. Building a system to download, process and store these datasets.
. Checking passwords to see if they've been compromised.
. Taking action when a leaked credential is found.

FusionAuth has taken care of steps 1, 2 and 3. All you need to do is to configure your breached password detection options.

The end goal, of course, is to have a more secure auth system by avoiding unauthorized access due to any of your users' credentials being compromised.

== How Do I Use Breached Password Detection 

*This is a paid edition feature and is unavailable in the community edition. Please visit link:/pricing[our pricing page] to learn more about paid editions.*

Here's a video showing setup and usage of the breached password detection feature.

video::JUB-5wQ_fdI[youtube,width=560,height=315]

Conceptually, FusionAuth uses a pull model rather than a push model. Passwords are checked only when the user provides, at registration, password change, or, optionally, during login. 

== Setting Up

The first step to enabling breached password detection is to have a valid license key. Please visit link:/pricing[our pricing page] to learn more about paid editions and to buy a license.

The next step is to activate your license key. You'll need to ensure that your FusionAuth instance has outbound network access. Follow the steps outlined in the link:/docs/v1/tech/reactor[Reactor documentation].

Navigate to the [breadcrumb]#Tenants# tab and edit the tenant for which you wish to enable breached password detection. Go to the [breadcrumb]#Password# tab and the [breadcrumb]#Breached password detection settings# section. Click the checkbox to enable breached password detection. This will open up a new set of configuration options, as seen below:

image::guides/breached-password-detection/turn-on-detection.png[Turn on breached password detection,width=700,role=box-shadow margin-right]

The default settings prevent use of leaked passwords in a number of contexts. Simply by enabling breached password detection, all users within this tenant will, from that moment forward, no longer be able to use any password that has been found to be breached by the FusionAuth team.

Passwords will be checked any time they are changed, such as:

* at user registration
* when a password change initiated by an end user
* a password changes made by an administrative user

You can see below that an administrative user will receive an error message should they attempt to change an end user's password to a value known to be breached:

image::guides/breached-password-detection/admin-user-attempting-to-use-breached-password.png[Error message when an administrative user tries to use a compromised password.,width=700,role=box-shadow margin-right]

However, if an administrative user changes any other user attribute without modifying the password, the current password won't be checked.

Password changes, whether triggered by a user interacting with the OAuth registration pages or an application using the API, will cause the password to be checked against the latest corpus of compromised passwords. If there is a match, an error will be returned.

== Configuration Options

While the default settings are good, you may want to configure this feature further. Here are the configuration options:

image::guides/breached-password-detection/breached-password-configuration-options.png[Breached password detection configuration options.,width=700,role=box-shadow margin-right]

Each of these configuration options can be updated using either the administrative interface or by calling the link:../apis/tenants[Tenant API].

=== Match Mode

When the system is seeing if credentials have been leacked, there are a number of ways to attempt to match them with the datasets. Assume you have a user with the username `richard@piedpiper.com` and the password `password!`.

One option is that the system could match on `password!` only. This means that if a user tries to change their password to `password!`, the system would see if that string had ever been leaked. This means that if any other user had ever used that password and it had been compromised, FusionAuth would disallow its use.

Another way of matching would be to see if there are any sub-email accounts which are associated with that password. These are also called aliases by some email providers. For instance, `richard+test@piedpiper.com` is an alias of `richard@piedpiper.com`. The system could check multiple aliases, such as `richard+test@piedpiper.com`, `richard+foo@piedpiper.com` and so on. All of these addresses would be paired with the provided password and checked against the datasets.

You could also narrow your scope further and match on only the username/password pair. The system can examine if `richard@piedpiper.com` and `password!` appeared together in the leaked passwords.

Finally, the system could check if the string `password!` is a commonly compromised password. If it is prevalent in breached password lists, it is a good password to avoid.

You can control which level of matching will disallow use of a password. This is called the *Match mode* configuration setting and can be one of the following values:

* `High` means that should any of the above situations hold, the check fails. This is the strictest option.
* `Medium` means that an exact username and password match, a commonly compromised password, or a sub-email address match disqualifies the password.
* `Low` means that an exact username and password match or a commonly compromised password results in a failed check.

The stricter the match mode, the more likely your users will be forced to choose a different password because the one they choose has been leaked.

=== On Login

The matching and prohibition of compromised passwords takes place whenever the user is creating or changing a password, as mentioned above. However, there is one other time when a breached password check may make sense. That is at user login. 

Consider this scenario: a user signs up on example.com with a password. They come to your site and sign up with the same password. They continue to use your application for months, but forget about their example.com account. 

Then, example.com has a data breach. They may send out a notice, but your user may ignore it or may forget to change their password across every system where they reused it. 

If you only check for compromise when the password is created at registration or modified by the end user, youâ€™ll end up with users with credentials that have been leaked by breaches external to your system. The example.com breach will negatively affect your application through the vector of the reused password. 

For this reason, it's a good idea to detect breached passwords whenever a user logs in.

However, this raises another issue. What do you do when you detect a breached password at login? At the other times the system is checking, the password is being modified, so it is easy to prohibit the compromised value; just notify your users that the password is not allowed.

However, at sign in, the user isn't expecting to change their password. So what is the appropriate action? It depends on your requirements, but FusionAuth provides three different options. They are, listed in increasing impact to the user experience:

* Record the breach in metrics 
* Send the user an email
* Require the user to change their password

With any of these options, you can subscribe to a webhook notifying you of the password breach event.

==== Recording the Breach 

Recording the breach and optionally firing a webhook is a good fit for two scenarios. If you're exploring breached password detection and unsure how it will affect your end users, you can gauge how many of them have compromised passwords by using this setting. 

Another reason to use this option is if you have link:../events-webhooks/[webhooks] set up. You may handle a breached password in custom code, rather than using any of the default FusionAuth options. Listening for the webhook lets you handle this event in any way you desire. You could:

* Automatically run a security audit on systems to which the user with the compromised credentials has access
* Lock the account and send an SMS notification
* Flip a flag on their account to more closely monitor it for suspicious activity in the future

All of these require custom code on your end, of course, but the webhook can trigger any custom action.

==== Sending an Email

Sending the user an email lets the user know that their account could be compromised, but doesn't force them to take any action.

This email is an link:../email-templates/[email template] which can be customized and localized similar to any other template. You'll typically include a link to reset their password, but you may want to include other information as well. Below is the default HTML template.

.HTML Breached Password Email Template
[source,text]
----
include::docs/src/email/breached-password.html[]
----

Please see the link:/docs/v1/tech/email-templates/email-templates#breached-password[email template documentation] for more information, including available template variables.

==== Requiring a Password Change

The final option for handling breached passwords at user sign in is to require a password change. Once a password has been checked and found to be breached, the account is marked in the system as requiring a changed password. The user will be forced to change their password whenever they attempt to login. Be aware that changing the 'On login' setting to a different option will have no effect on accounts so marked.

When this option is enabled, if you are using the FusionAuth templates, the page displayed to the user after they login with a compromised password is is generated by the "OAuth Change password form" template. As with any other template, you can customize it, including look and feel and any messages displayed. Please check out the link:../email-templates/[themes documentation] for more information.

If you are instead using the link:../apis/login[login API], the API call will respond with a `203` HTTP status code. Please review the API documentation for more information. 

You can also read the <<End User Experience>> section for a deeper understanding of what the end user will encounter.

=== Recommended Settings

The recommended options for maximum protection from compromised passwords are:

* a *Match mode* of *High*
* setting the *On login* option to require a password change. Alternatively, set this value to only record the result and configure a webhook to process password breach events in a custom manner.

Of course, choose options that work for you and your system. This is why FusionAuth provides the configuration choices outlined above. 

== Breached Password Detection Reporting

Reporting is a key part of breached password detection. Aggregate information across all your users can help inform which actions to take on detection, both within FusionAuth and in external systems. 

Reports also let you know which users have a breached account credentials. This allows you contact or take other actions on the compromised account.

=== Overview Report

The overview report is found on the [breadcrumb]#Reactor# tab of the administrative user interface:

image::guides/breached-password-detection/overview-report.png[Overview password breach report,width=700,role=box-shadow margin-right]

This report displays the total number of checked passwords, detected breaches and accounts with action required. These numbers are displayed for the entire FusionAuth instance as well as on a per tenant basis, should you be using the multi-tenant functionality.

=== User Report

You can also view a list of all users with breached passwords. To do so, click on the *Breached users* search button on the [breadcrumb]#Reactor# tab of the administrative user interface. You'll see this report:

image::guides/breached-password-detection/user-report.png[Individual password breach report,width=700,role=box-shadow margin-right]

This is a paginated list of users with compromised credentials. You can then manage the user or lock their account. If you navigate to the user's details page, you see a warning about their vulnerable password, based on the match type of the compromised password:

image::guides/breached-password-detection/admin-user-vulnerable-message.png[The vulnerable password message in the admin interface,width=700,role=box-shadow margin-right]

You'll also be able to modify the account. Options include locking their account, forcing a password change or resetting their password and sending them an email:

image::guides/breached-password-detection/acting-on-a-user.png[Acting on a user,width=700,role=box-shadow margin-right]

=== Custom Reporting

If you have custom reporting needs, such as querying on the number of users with breached passwords over time, or finding the number of users with multiple password breaches, ingest the data into your own analytics system.

The best method to do so is to set up a webhook to listen for the link:../events-webhooks/events#user-password-breach[`user.password.breach` event]. 

You can read more about setting up link:../events-webhooks/[webhooks here].

== End User Experience

What does the end user experience when a breached password is detected? It depends on whether they are registering or logging in when the breach is detected.

It also depends on whether you are using the FusionAuth provided page templates or have built your own integration using the link:../apis/[APIs].

=== FusionAuth Provided Templates

If the user is registering or logging in with the provided page templates, they'll see this on registration, should they choose a password the system determines has been compromised:

image::guides/breached-password-detection/oauth-registration-breached-message.png[What a user who is registering with a breached password will see.,width=700,role=box-shadow margin-right]

They will not be able to complete a registration without choosing a more secure password.

If you enable breach detection on login, but do not require a password change, the end user will see no difference between signing in with a secure or compromised password. If you enable sending an email, the user will receive that notice.

If you, on the other hand, require a password change, a user signs in with a password that is found to have been compromised, they'll see:

image::guides/breached-password-detection/oauth-login-breached-message.png[What a user who is signing in with a breached password will see.,width=700,role=box-shadow margin-right]

These pages can be customized, both in the messages displayed to the end user and in the look and feel. Please visit the link:../themes[themes documentation] for more information.

=== API Responses

When you create a user with the link:../apis/users[User APIs] and breached password detection is enabled, you'll receive an error if the password is compromised. The HTTP status code will be `400` and you'll receive a response containing an error object.

.JSON response when attempted user created with a breached password
[source,json]
----
{
  "fieldErrors": {
    "user.password": [
      {
        "code": "[breachedCommonPassword]user.password",
        "message": "The [user.password] property value has been breached and may not be used, please select a different password."
      }
    ]
  }
}
----

If you enable breach detection on login and don't require a password change, you'll receive a `200` HTTP status code on successful login and the normal JSON response. Please see the link:../apis/login[Login API] documentation for more.

If you require a password change, you'll receive a `203` HTTP status code should the user's password have been compromised. You'll also receive JSON explaining why the password change is required:

.JSON response when attempted user created with a breached password
[source,json]
----
{
  "changePasswordId": "yo0FiR_y7Rrtrk2vKe_F93PQ-nWljfGGWexgNSbHfXQ",
  "changePasswordReason": "Breached"
}
----

You can then use the link:../apis/users#change-a-users-password[Change a User's Password API] to, well, change the user's password.

== How It Works

Here's a high level diagram of the FusionAuth breached password detection service:

image::guides/breached-password-detection/breached-password-detection-diagram.png[Diagram of the breached password detection system.,width=700,role=box-shadow margin-right]

New breached passwords are ingested and processed by FusionAuth on an ongoing basis. An additional encryption key is used to securely communicate with the FusionAuth Reactor service using a strong AES cipher. 

You can rotate this key by navigating to the [breadcrumb]#Reactor# tab and clicking the *Regenerate Key* button. When you do so, you'll be prompted to confirm this decision:

image::guides/breached-password-detection/regenerating-the-key.png[Regenerating the AES key.,width=700,role=box-shadow margin-right]

== Limitations

Breached password detection in FusionAuth has a few limitations of which you should be aware.

As you might expect, it can't check passwords controlled by other systems, such as when you use an link:../identity-providers/[external identity provider].

All other password rules, as defined in the tenant configuration, apply when passwords are changed. For example, if you set a minimum length of 25 characters for passwords in addition to enabling breached password detection, both conditions must be satisfied for a password to be accepted. The user will have to select a password that is at least 25 characters long and not known to have been compromised.

Breached password detection is configured at the tenant level and applies to all applications within that tenant. For example, if you enable detection for the `Default` tenant, where the FusionAuth application resides, administrative users with access to that application will have their passwords checked.

Due to the salting and computational intensity of checking passwords, there's no way to examine passwords in an offline or batch fashion.

The breached password detection webhook event, `user.password.breach`, is only fired when login breach detection is enabled. It is not fired on registration because the compromised password has never entered the FusionAuth system.

++++
{% capture relatedTag %}feature-breached-password-detection{% endcapture %}
{% include _doc_related_posts.liquid %}
++++

