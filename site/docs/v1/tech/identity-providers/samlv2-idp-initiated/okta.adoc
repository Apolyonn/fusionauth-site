---
layout: doc
title: SAML v2 IdP Initiated With Okta
description: Configure SAML v2 IdP Initiated SSO With Okta
---

== Configure SAML v2 IdP Initiated SSO With Okta

This page will guide you in configuring a SAML v2 IdP Initiated Identity Provide with Okta as the initiating IdP. You will be able to visit an Okta provided link, authenticate and then be logged in to FusionAuth.

This document assumes you have an admin account with Okta and a valid FusionAuth paid edition license. 

index.adoc:include::docs/v1/tech/shared/_premium-edition-blurb.adoc[]



== Create and Partially Configure the Okta SSO Application

Navigate to your Okta admin screen, and then add an application.

Search for `SAML Service Provider` and add this application.

image::identity-providers/idp-initiated/okta-add-saml-service-provider-initial-screen.png[Setting up a SAMLv2 application in Okta,width=1200]


Add an [field]#Application label# describing the application. Configure any other "General Settings" as needed.

image::identity-providers/idp-initiated/okta-general-settings.png[General settings tab when creating a SAMLv2 application in Okta,width=1200,role=bottom-cropped]

Click "Next" and start in on the "Sign-On Options".

image::identity-providers/idp-initiated/okta-sign-in-options.png[Sign-on settings tab when creating a SAMLv2 application in Okta,width=1200]

Click "View Setup Instructions". This will open a separate tab.

image::identity-providers/idp-initiated/okta-saml-sp-configuration-instructions.png[Configuration instructions for the SAML SP when creating a SAMLv2 application in Okta,width=1200,role=bottom-cropped]

Note the [field]#Identity Provider Issuer# and [field]#Identity Provider HTTP Post URL# values. The former will be a string like `exkq14ymac31Bx7895d6`. (There may be a typo, with `is` being concatenated to the value.)

Download the Identity Provider Certificate as well. You can now close the setup instructions tab.

== Add the Okta Public Certificate to FusionAuth

Log in to the FusionAuth administrative user interface and navigate to [breadcrumb]#Settings -> Key Master#. Then, import the provided certificate.

image::identity-providers/idp-initiated/add-okta-public-certificate-to-keymaster.png[Adding the Okta certificate to Key Master,width=1200]

== Add the SAMLv2 IdP Initiated Identity Provider

Navigate to [breadcrumb]#Settings -> Identity Providers#. Then add a SAMLv2 IdP Initiated Provider.

Configure the [field]#Name# with a descriptive value.

Set the [field]#Issuer# value to the [field]#Identity Provider Issuer# value from Okta.

Set the [field]#Verification key# to the public certificate imported previously.

Enable this identity provider for the application (`Pied Piper` in this case). Any users who authenticate with Okta will be automatically registered for this application because of the [field]#Create registrations# setting.

All other options may be left to their default values. Save the configuration.

image::identity-providers/idp-initiated/fusionauth-add-okta-identity-provider.png[Adding the IdP Initiated SSO Identity Provider,width=1200]

== View the Identity Provider in FusionAuth

Next view the new Identity Provider and navigate to the [field]#SAML v2 Integration details# section.

Note the values of the [field]#Callback URL (ACS)# and [field]#Issuer#.

image::identity-providers/idp-initiated/fusionauth-view-identity-provider.png[View the IdP Initiated SSO Identity Provider,width=1200]


== CORS settings

Navigate to [breadcrumb]#Settings -> System -> CORS#. 

Determine the hostname and scheme of the Okta Identity Provider HTTP POST URL. If the URL is `https://example.okta.com/app/generic-saml/exkq1851wmJ3HKZYD5d6/saml2`, then the hostname and scheme are `https://example.okta.com`.

Add this value to the CORS [field]#Allowed origins# and make sure that `POST` is a value in the [field]#Allowed methods# field. Then save the configuration

image::identity-providers/idp-initiated/fusionauth-cors-settings.png[Configure CORS,width=1200]

== Configure the FusionAuth Application Redirect URL

Navigate to [breadcrumb]#Applications -> Your Application -> OAuth#. Update the [field]#Authorized redirect URLs# field to include `https://local.fusionauth.io/?client_id=CLIENTID` where CLIENTID is the value from the [field]#Client id# field.

Also, ensure the Authorization code grant is enabled for the appliation.

image::identity-providers/idp-initiated/fusionauth-set-up-application.png[Configure the FusionAuth Pied Piper application,width=1200]

== Complete SSO Configuration in Okta

Return to the the "Sign-on Options" tab in the Okta Admin screen.

Set the value of the [field]#Assertion Consumer Service URL# to the value of the [field]#Callback URL (ACS)# from the FusionAuth Identity Provider configured above.

Set the value of the [field]#Service Provider Entity Id# to the value of the [field]#Issuer# configured above.

Set the [field]#Application username format# to be `Email`. 

image::identity-providers/idp-initiated/okta-sign-on-advanced-settings.png[Configure Okta with the FusionAuth SP information,width=1200]

You can then save the application by clicking "Done".

Scroll to the [breadcrumb]#App Embed Link# section and note the [field]#Embed Link# value. This is the link you'll visit to kick off the IdP initiated SSO.

Click on the [breadcrumb]#Assignments# tab and add the user to the application.

image::identity-providers/idp-initiated/okta-assign-application-to-user.png[Assigning a user to the SAML SP application,width=1200]

== Test It Out

You can now open up an incognito window and visit the [field]#Embed Link# value. You will be prompted to log in with your Okta IdP credentials. 

image::identity-providers/idp-initiated/okta-login-page.png[Logging in with Okta,width=1200]

When you authenticate, you'll end up at the URL you configured in the application's [field]#Authorized redirect URLs# field. The URL in your brownser will contain an authorization code.

Since you configured registration for this Identity Provider, if the user did not previously exist in your FusionAuth instance, they will now be present.

For a production application, the authorization code would be processed by your application and exchanged at the token endpoint for a JWT from FusionAuth.


