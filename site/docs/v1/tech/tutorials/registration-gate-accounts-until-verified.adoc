---
layout: doc
title: Gate Users Application Registration
description: How to gate users on the application level until verified.
---

== Overview

As of version 1.27.0, FusionAuth can be configured to gate users' accounts until they verify by clicking a link allowing them into an application. While users successfully authenticate, they won't be able to proceed further until they have verified their registration via email.

=== Why do I need this?


Most folks will be happy to have email verification gating(see adjacent tutorial link:/docs/v1/tech/tutorials/gate-accounts-until-verified[here]).  However, there are times when you want to enforce opt-in behavior to specific applications. A good example of this might be Google. A YouTube user and a Drive user are part of the same parent company (tenant, to follow our metaphor within FusionAuth).  However, Google will require a user to complete an application registration to allow the same user on YouTube access to Drive.  Without this step, users may find it alarming their logins work for both Youtube and Drive.

image::tutorials/gate-accounts-until-verified/application-registration-google.png[Google Applications Web,width=600,role=bottom-cropped custom]

=== To Enable

To enable registration verification gating, do the following:

* Configure the tenant with your email server
* Configure the application to enable registration gating
* Optionally customize the registration verification template
* Enable self service registration
* Configure your application with a redirect URL (OAuth tab)


Let's step through each of these, but first, there are some required prerequisites.

== Prerequisites

include::docs/v1/tech/shared/_premium-edition-blurb.adoc[]

This tutorial assumes you are running FusionAuth version 1.27.0 or greater. If you aren't, head on over to the link:/docs/v1/tech/installation-guide/[installation guide] or the link:/docs/v1/tech/installation-guide/upgrade/[upgrade guide] to update to a version with support for this feature.

This tutorial also assumes you have a paid edition and valid license. If you need to buy an edition, please visit the link:/pricing/editions/[pricing page]. If you need to activate your instance, please visit the link:/docs/v1/tech/reactor/[Reactor page].

== Configure the Tenant Email Server

Log in to the FusionAuth administrative user interface. You could do all of this configuration with the API or kickstart, but for this tutorial you'll use the UI.

Navigate to [breadcrumb]#Tenants -> Your Tenant# and then select the [breadcrumb]#Email# tab. Scroll to the [breadcrumb]#SMTP settings# section. Configure this with your SMTP server information. If you are testing locally, you can use a mock email server like https://mailcatcher.me/[mailcatcher].

image::tutorials/gate-accounts-until-verified/tenant-smtp-settings.png[Tenant SMTP settings,width=1200,role=bottom-cropped]

Ensure a test email is delivered. If you have any issues, follow the steps in the link:/docs/v1/tech/troubleshooting/#troubleshooting-email[email troubleshooting documentation].

Save the configuration.

== Enable Registration Verification Gating

Navigate to [breadcrumb]#Applications-> Your Application# and then select the [breadcrumb]#Registration# tab. Scroll to the [breadcrumb]#Registration verification settings# section.

* Enable [field]#Verify registration#.
* Choose your email template. The default template is `Registration verification`, and that will work fine for this tutorial.
* Update the [field]#Verification strategy#. This can be either `ClickableLink` or `FormField`. The former sends an email with a link to verify the user's address and intent to register for your application. The latter emails a code which the user will provide to FusionAuth. For this tutorial, use `ClickableLink`.
* Ensure that the [field]#Unverified behavior# value is `Gated`.

After these steps, you should end up with a configuration screen that looks like this:

// TODO : JOSH : Update photo
image::tutorials/gate-accounts-until-verified/tenant-email-verification-settings.png[Tenant email verification settings,width=1200,role=bottom-cropped]

Make sure you save the configuration.

== Configure the Application

Navigate to [breadcrumb]#Applications#. Edit your application by clicking on the blue "Edit" button.

Enable self registration by selecting the [breadcrumb]#Registration# tab, and then scrolling to the [breadcrumb]#Self service registration# section.

[NOTE]
====
You can create a user with an unverified registration in other ways than self service registration. However, self service registration is the simplest way to create a user without a verified registration.
====

Enable self service registration and configure the displayed and required fields as desired.

image::tutorials/gate-accounts-until-verified/application-enable-self-registration.png[Enabling application self registration,width=1200]

Next, navigate to the [breadcrumb]#OAuth# tab. Enable the `Authorization Code` grant.

In addition, ensure you have entered a valid URL in the [field]#Authorized redirect URLs# field. (The value of this redirect URL doesn't really matter for this tutorial. But for production use, ensure the code at that endpoint can exchange an authorization code for a token.)

Save the application configuration. You'll be returned to the list of applications.

Click on the green "View" button of your application to see the details of your application.

image::tutorials/gate-accounts-until-verified/view-application-details.png[View application details to see the relevant URLs,width=1200]

Look for the [field]#Registration URL#. It'll be something like `https://local.fusionauth.io/oauth2/register?client_id=85a03867-dccf-4882-adde-1a79aeec50df&response_type=code&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Foauth-redirect`. Copy that value as you'll use it below.

At the same time, find the [field]#OAuth IdP login URL#, and copy that as well.

== Customize the Registration Verification Template

Navigate to [breadcrumb]#Customizations -> Email Templates#. Edit the `Registration Verification` template by clicking on the blue "Edit" button.

Modify the HTML and text templates as desired and then save them. You can also localize the messages.

// TODO : JOSH : Update photo
image::tutorials/gate-accounts-until-verified/registration-template-customization.png[Customizing the registration verification email template,width=1200]


== Test It Out

Now, test out the functionality. Register a new account. Make sure to use a different browser or incognito mode so that the admin account you logged in with while configuring FusionAuth doesn't interfere with new user registration.

Visit the registration URL copied above. You'll be prompted to register. Fill out the form with a valid email address. After registration is complete, you'll receive an email prompting you to verify the registration.

Here is the email in the mailcatcher user interface:

// TODO : JOSH : Update photo
image::tutorials/gate-accounts-until-verified/verification-registration-email-mailcatcher.png[Verification email in mailcatcher,width=1200,role=bottom-cropped]

This user account will be gated and unable to completely log in if you have not verified the registration by verifiying through email. In your browser where you registered, you'll see a page similar to below:

// TODO : JOSH : Update photo
image::tutorials/gate-accounts-until-verified/registration-verification-gate-screen-clickable-link.png[Clickable link default registratiohn verification gate screen,width=1200,role=bottom-cropped]

To test the gating, open a different browser (not a window, but an entirely different browser) and visit the login URL copied above. Enter the email and password for the user you just registered.

You'll be sent to the same registration verification gate page.

No matter which API or hosted login page you use, no JWT will be issued until the user registration has been verified. The user will continue to see the verification prompt when they log in until then.

If an API is being used to authenticate the user, the API will return a status code indicating registration verification has not yet occurred. Please see the link:/docs/v1/tech/apis/login/[Login API] for more details.

If you view the user in the administrative user interface, and click on the `source` tab you should see the following attributes on the user.


// TODO : JOSH : Update photo
image::tutorials/gate-accounts-until-verified/unverified-user-details-screen.png[Unverified user details screen,width=1200,role=bottom-cropped]

Once you have verified the email address by clicking on the link, you can now login and will be sent to the configured redirect URL.

== Next Steps

Now that you've successfully set up gated email verification, take the next steps to integrate this functionality into your application:

* Discover how to link:/docs/v1/tech/themes/[modify your theme] to make the email verification gate pages look like your application.
* Learn more about link:/docs/v1/tech/email-templates/[email templates] and how to customize them.
* Have the user submit a passcode rather than click a link. With this option, the user will be prompted with a screen similar to the below image.

image::tutorials/gate-accounts-until-verified/email-verification-gate-screen-code-entry.png[Code entry default email gate screen,width=1200,role=bottom-cropped]

include::/docs/v1/tech/tutorials/_gated_workflows_troubleshooting.adoc