---
layout: advice
title: "Let's talk about JWTs baby!"
description: "The pros and cons of JWTs and why you should (or shouldn't) use them."
image: fusionauth-share-image.jpg
header_dark: true
categories:
- tokens
---

<section>
  <div class="container">
    <div class="row">
      <article class="col-12 col-lg-9">
        <div class="">
          <div class="pt-5 ">
            <p><a href="/learn/expert-advice">Expert Advice</a> > <a href="/learn/expert-advice/oauth/">OAuth</a></p>
          </div>
          <h1>Let's talk about JWTs baby!</h1>
          <p>Brian Pontarelli</p>
          <i class="fal fa-star text-primary mb-3"></i>
          <i class="fal fa-star text-primary mb-3"></i>
          <i class="fal fa-star text-primary mb-3"></i>
          <i class="fal fa-star text-primary mb-3"></i>
          <i class="fal fa-star text-primary mb-3"></i>
        </div>
        <div class="embed-responsive embed-responsive-2by1">
          <div class="embed-responsive-item text-center">
            <img class="post-image" src="/assets/img/blogs/jwt-knuckle-bump.jpg">
          </div>
        </div>
      </article>
      <article class="col-12 col-lg-9">
        <div class="post-body mt-5">
          <div class="post-body-content">

            <p>Let’s talk about JWTs (JSON Web Tokens, pronounced “jot”). JWTs are becoming more and more ubiquitous. Customer identity and access management (CIAM) providers everywhere are pushing JWTs as the silver bullet for everything. JWTs are pretty cool, but let’s talk about some of the downsides of JWTs and other solutions you might consider.
<!--more--></p>

<p>The way I usually describe JWTs is that they are portable units of identity. That means they contain identity information as JSON and can be passed around to services and applications. Any service or application can verify a JWT itself. The service/application receiving a JWT doesn’t need to ask the identity provider that generated the JWT if it is valid. Once a JWT is verified, the service or application can use the data inside it to take action on behalf of the user.</p>

<p>Here’s a diagram that illustrates how the identity provider creates a JWT and how a service can use the JWT without calling back to the identity provider: (yes that is a Palm Pilot in the diagram)</p>

<p><img src="/assets/img/blogs/Lets-talk-about-JWTs-Diagram-1.png" alt="JWT example" class="full img-thumbnail mr-md-4" style="" /></p>

<p>When you contrast this with an opaque token, you’ll see why so many developers are using JWTs. Opaque tokens are just a large string of characters that don’t contain any data. A token must be verified by asking the identity provider if it is still valid and returning the user data the service needs.</p>

<p>Here’s a diagram that illustrates how the identity provider is called to verify the opaque token and fetch the user data:</p>

<p><img src="/assets/img/blogs/Lets-talk-about-JWTs-Diagram-2-1.png" alt="Opaque token example" class="full img-thumbnail mr-md-4" style="" /></p>

<p>This method of verifying and exchanging tokens can be very “chatty” and it also requires a method of persisting and loading the tokens inside the identity provider. JWTs on the other hand don’t require any persistence or logic in the identity provider since they are portable.</p>

<p>There are a couple of things you should consider when deciding to use JWTs. Let’s look at a few of the main ones.</p>

<h2 id="jwts-expire-at-specific-intervals">JWTs expire at specific intervals</h2>

<p>When a JWT is created it is given a specific expiration instant. The life of a JWT is definitive and it is recommended that it is somewhat small (think minutes not hours). If you have experience with traditional sessions, JWTs are quite different. Traditional sessions are always a specific duration from the last interaction with the user. This means that if the user clicks a button, their session is extended. If you think about most applications you use, this is pretty common. You are logged out of the application after a specific amount of inactivity. JWTs on the other hand, are not extended on user interaction. Instead, they are programmatically replaced by creating a new JWT for the user.</p>

<p>To solve this problem, most applications use refresh tokens. Refresh tokens are opaque tokens that are used to generate new JWTs. Refresh tokens also need to expire at some point, but they can be more flexible in this mechanism because they are persisted in the identity provider. This also makes them similar to the opaque tokens described above.</p>

<h2 id="jwts-are-signed">JWTs are signed</h2>

<p>Since JWTs are cryptographically signed, they require a cryptographic algorithm to verify. Cryptographic algorithms are purposefully designed to be slow. The slower the algorithm, the higher the complexity, and the less likely that the algorithm can be cracked using brute-force.</p>

<p>On a quad-core MacBook Pro, about 200 JWTs can be created and signed per second using RSA public-private key signing. This number drops dramatically on virtualized hardware like Amazon EC2s. HMAC signing is much faster but lacks the same flexibility and security characteristics. Specifically, if the identity provider uses HMAC to sign a JWT, then all services that want to verify the JWT must have the HMAC secret. This means that all the services can now create and sign JWTs as well. This makes the JWTs less portable (specifically to public services) and less secure.</p>

<p>To give you an idea of the performance characteristics of JWTs and the cryptographic algorithms used, our team ran some tests on a quad-core MacBook. Here are some of the metrics and timings we recorded for JWTs:</p>

<table>
<thead>
  <tr>
    <th>Metric</th>
    <th> </th>
    <th>Timing</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>JSON Serialization + Base64 Encoding</td>
    <td> </td>
    <td>400,000/s</td>
  </tr>
  <tr>
    <td>JSON Serialization + Base64 Encoding + HMAC Signing</td>
    <td> </td>
    <td>150,000/s</td>
  </tr>
  <tr>
    <td>JSON Serialization + Base64 Encoding + RSA Signing</td>
    <td> </td>
    <td>200/s</td>
  </tr>
  <tr>
    <td>Base64 Decoding + JSON Parsing</td>
    <td> </td>
    <td>400,000/s</td>
  </tr>
  <tr>
    <td>Base64 Decoding + JSON Parsing + HMAC Verification</td>
    <td> </td>
    <td>130,000/s</td>
  </tr>
  <tr>
    <td>Base64 Decoding + JSON Parsing + RSA Verification</td>
    <td> </td>
    <td>6,000/s</td>
  </tr>
</tbody>
</table>

<p><br /></p>
<h2 id="jwts-arent-easily-revocable">JWTs aren’t easily revocable</h2>

<p>This means that a JWT could be valid even though the user’s account has been suspended or deleted. There are a couple of ways around this including the “refresh token revoke event” combined with a webhook. This solution is available in FusionAuth. You can check out the blog post I wrote on this topic here: <a href="/blog/2019/01/31/revoking-jwts/" title="Learn about Revoking JWTs">Revoking JWTS</a> and also watch the IBM webinar where I presented our solution here (when FusionAuth was still called Passport): <a href="https://developer.ibm.com/tv/learn-how-to-revoke-json-web-tokens/" title="Jump to IBM Developer site">Learn how to revoke JSON Web Tokens</a>.</p>

<h2 id="jwts-have-exploits">JWTs have exploits</h2>

<p>This is more a matter of bad coding than flaws that are inherent to JWTs. The “none” algorithm and the “HMAC” hack are both well know exploits of JWTs. I won’t go into details about these exploits here, but if you search around a bit you can find many discussions of them.</p>

<p>Both of these exploits have simple fixes. Specifically, you should never allow JWTs that were created using the “none” algorithm. Also, you should not blindly load signing keys using the “kid” header in the JWT. Instead, you should validate that the key is indeed the correct key for the algorithm specified in the header.</p>

<h2 id="sessions-as-an-alternative">Sessions as an Alternative</h2>

<p>Instead of using JWTs or opaque tokens, you always have the option of using sessions. Sessions have been around for over two decades and are proven technology. Sessions generally work through the use of cookies and state that is stored on the server. The cookie contains a string of characters that is the session id. The server contains a large Hash that keys off the session id and stores arbitrary data.</p>

<p>When a user logs in, the user object is stored in the session and the server sends back a session cookie that contains the session id. Each subsequent request to the server includes the session cookie. The server uses the session cookie to load the user object out of the session Hash. The user object is then used to identify the user making the request. Here are two diagrams that illustrate this concept:</p>

<h3 id="login">Login</h3>

<p><img src="/assets/img/blogs/Lets-talk-about-JWTs-Diagram-3-1.png" alt="login example for sessions" class="full img-thumbnail mr-md-4" style="" /></p>

<h3 id="second-request">Second request</h3>

<p><img src="/assets/img/blogs/Lets-talk-about-JWTs-Diagram-4-2.png" alt="API call with session example" class="full img-thumbnail mr-md-4" style="" /></p>

<p>If you have a smaller application that uses a single backend, sessions work well. Once you start scaling or using microservices, sessions can be more challenging. Larger architectures require load-balancing and session pinning, where each client is pinned to the specific server where their session is stored. Session replication or a distributed cache might be needed to ensure fault tolerance or allow for zero-downtime upgrades. Even with this added complexity, sessions might still be a good option.</p>

<p>I hope this brief overview of JWTs and Sessions has been helpful in shedding some light on these technologies that are used to identity and manage users. Either of these solutions will work in nearly any application. The choice generally comes down to your needs and the languages and frameworks you are using.</p>

<h2 id="learn-more-about-fusionauth">Learn More About FusionAuth</h2>
<p>FusionAuth is designed to be the most flexible and secure Customer Identity and Access Management solution available at the best price. We provide registration, login, passwordless login, SSO, MFA, data search, social login, user management and more, 100% free for unlimited users.</p>

<p><a href="/" title="FusionAuth Home" class="btn btn-primary">Learn More</a></p>


          </div>

<div class="text-center mt-5 mb-5 py-5">
  <hr>
    <div class="mt-5 mb-5">
      <p>How helpful was this article? Click a star to rate.</p>
      <i class="fal fa-star text-primary mb-3"></i>
      <i class="fal fa-star text-primary mb-3"></i>
      <i class="fal fa-star text-primary mb-3"></i>
      <i class="fal fa-star text-primary mb-3"></i>
      <i class="fal fa-star text-primary mb-3"></i>
    </div>
  <hr>
</div>

<!-- comments -->
          <div class="post-body-comments">
            <div class="just-comments" data-apikey="edc7b4a8-97ce-47ba-9e21-0477407197ef"></div>
            <script async src="https://just-comments.com/w.js"></script>
          </div>
        </div>
      </article>


      <!-- side bar -->
      <div class="col-12 col-lg-3">
        <div class="mt-5">
          <div class="p-4 border">
            <h2>Related Articles</h2>

            <a class="d-block mt-3 mb-3 link-dark" href="/blog/2019/10/29/oauth-device-authorization-roku-appletv-xbox">How-To: OAuth Device Authorization for Roku, AppleTV, and XBox</a>

            <a class="d-block mt-3 mb-3 link-dark" href="/blog/2019/10/09/build-fusionauth-python-login-web-app-flask">Title</a>

            <a class="d-block mt-3 mb-3 link-dark" href="/blog/2019/10/08/deactivating-reactivating-deleting-user-fusionauth-python">Deactivating, Reactivating, and Deleting A FusionAuth User in Python</a>

            <a class="d-block mt-3 mb-3 link-dark" href="/blog/2019/10/02/storing-user-data">Storing User Data in FusionAuth</a>

          </div>
          <div class="mt-4 mb-4 bg-secondary p-4 text-center text-white">
            <img class="w-100" src="/assets/img/fusionauth-logo-white-orange.svg">
            <p class="mt-4 text-light">
              FusionAuth provides authentication, authorization, and user management for every app: deploy anywhere, integrate with anything, in minutes.
            </p>
            <a class="btn btn-lg btn-primary text-uppercase mt-3 mb-4">Get Started for Free</a>
          </div>

        </div>
      </div>
    </div>
  </div>
</section>


<section class="bg-secondary pt-6 pb-6">
  <div class="container text-center text-white">
    <h2 class="text-white h1">FusionAuth is Auth Built for &lt;devs&gt;</h2>
    <p class="h5 text-white mt-4">FusionAuth gives devs complete flexibility with minimal implementation effort. Use our Fast Path install to get started in minutes.</p>
    <a href="/" class="btn btn-primary btn-lg mt-4 mb-4">Learn More</a>
    <h4 class="text-light mb-4">We got this. Go build the cool stuff.</h4>
    <img src="/assets/img/fusionauth-logo-white-orange.svg" alt="FusionAuth Logo" class="m-auto mt-4 mb-4" style="max-width: 250px">
  </div>
</section>

{% include macros/subscribe.html %}
