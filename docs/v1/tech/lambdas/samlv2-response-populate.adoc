---
layout: doc
title: SAML v2 Populate lambda
description: An overview of the SAML v2 populate lambda
---

:sectnumlevels: 0

== SAML v2 Populate lambda

In order to handle complex integrations with SAML service providers, you can specify a lambda to be used by the FusionAuth SAML identity provider. This lambda will be invoked prior to the SAML response being sent back to the service provider.

When you create a new lambda using the FusionAuth UI we will provide you an empty function for you to implement. If you are using the API to create the lambda you will need to ensure your function has the following signature:

[source,javascript]
----
function populate(samlResponse, user, registration) {
  // Lambda code goes here
}
----

This lambda must contain a function named `populate` that takes three parameters. The parameters that the lambda is passed are:

* samlResponse - which is the SAML Response object
* user - which is the FusionAuth User object
* registration - which is the FusionAuth UserRegistration object

The two FusionAuth objects are well documented here in the link:../apis/users[User API] and link:../apis/registrations[Registration API] documentation. The SAML response object mimics the format of the XML document, but is designed to be much simpler to use than dealing with the DOM object model. Here is a list of the fields you have access to manipulate in the SAML response:

[cols="3a,7a"]
[.api]
.SAML Response Fields
|===
|samlResponse.assertion.attributes [type]#[Map<String, List<String>>]#
|A map of the attributes of the user. This is sometimes call the claims of the user. Since SAML attributes can be multi-valued, you will need to wrap single values in Arrays like this:

[source,javascript]
----
samlResponse.assertion.attributes['firstName'] = [user.firstName];
----

|samlResponse.assertion.conditions.audiences [type]#[List<String>]#
|A list of the audiences for this SAML response. By default, the `issuer` or `audience` from the form are used.

|samlResponse.assertion.conditions.notBefore [type]#[Long]#
|The instant that this assertion starts being valid. This is the number of milliseconds since Epoch UTC.

|samlResponse.assertion.conditions.notOnOrAfter [type]#[Long]#
|The instant that this assertion stops being valid. This is the number of milliseconds since Epoch UTC.

|samlResponse.assertion.issuer [type]#[String]#
|The issuer of this SAML assertion. This defaults to the `issuser` from the form.

|samlResponse.assertion.subject.nameID.format [type]#[String]#
|The `NameID` format for the id of the subject (user). FusionAuth uses the `emailaddress` format specified by the SAML specifications. It is not recommended that you change this unless you know what you are doing.

|samlResponse.assertion.subject.nameID.id [type]#[String]#
|The `NameID` id of the subject (user). This defaults to the user's email address. It is not recommended that you change this unless you know what you are doing.

|samlResponse.assertion.subject.confirmation.inResponseTo [type]#[String]#
|This is the ID from the SAML request. It is not recommended that you change this unless you know what you are doing.

|samlResponse.assertion.subject.confirmation.method [type]#[String]#
|The confirmation method FusionAuth uses for the subject (user). This default to `Bearer`. It is not recommended that you change this unless you know what you are doing.

|samlResponse.assertion.subject.confirmation.notBefore [type]#[Long]#
|The instant that this assertion's subject starts being valid. This is the number of milliseconds since Epoch UTC.

|samlResponse.assertion.subject.confirmation.notOnOrAfter [type]#[Long]#
|The instant that this assertion's subject stops being valid. This is the number of milliseconds since Epoch UTC.

|samlResponse.assertion.subject.confirmation.recipient [type]#[String]#
|The recipient of the subject. This defaults to the callback URL (ACS).

|samlResponse.destination [type]#[String]#
|The destination of the SAML response. This defaults to the callback URL (ACS).

|samlResponse.id [type]#[String]#
|A unique identifier for the SAML response that is generated by FusionAuth.

|samlResponse.inResponseTo [type]#[String]#
|This is the ID from the SAML request. It is not recommended that you change this unless you know what you are doing.

|samlResponse.issueInstant [type]#[Long]#
|The instant that this assertion was created. This is the number of milliseconds since Epoch UTC.

|samlResponse.issuer [type]#[String]#
|This is the issuer of the SAML response. This defaults to the name of this FusionAuth deployment.

|samlResponse.status.code [type]#[String]#
|The status code of the SAML response. Whenever the lambda is called, this will always be `Success`.

|samlResponse.status.message [type]#[String]#
|The status message of the SAML response. Whenever the lambda is called, this will always be `null`.
|===

== Example lambda

Here is an example of a simple Lambda that sets a few extra parameters into the SAML response from the User, including some custom data:

[source,javascript]
----
function populate(samlResponse, user, registration) {
  samlResponse.assertion.attributes['roles'] = registration.roles || [];
  samlResponse.assertion.attributes['favoriteColor'] = [user.data.favoriteColor];
}
----
